(()=>{"use strict";class e{constructor(e,t){const n=document.createElement(t.tag||"div");t.class&&n.classList.add(t.class),e.append(n),this.node=n}}class t{constructor(){const t=new e(document.querySelector(".wrapper"),{class:"info",tag:"span"}),n=new e(document.querySelector(".wrapper"),{class:"info",tag:"span"});t.node.textContent="Keyboard was created on Windows",n.node.textContent="To switch the language combination: left ctrl + alt"}}const n=[["Tilda","1","2","3","4","5","6","7","8","9","0","-","+","Backspace"],["Tab","q","w","e","r","t","y","u","i","o","p","[","]","BackSlash","Del"],["CapsLock","a","s","d","f","g","h","j","k","l","Semicolon","Quote","Enter"],["Shift","z","x","c","v","b","n","m",",",".","/","ArrowUp","ShiftRight"],["Ctrl","Win","Alt","Space","AltRight","ArrowLeft","ArrowDown","ArrowRight","CtrlRight"]],o={Tilda:{en:"`",enUp:"~",ru:"ё",ruUp:"Ё",code:"Backquote"},1:{en:"1",enUp:"!",ru:"1",ruUp:"!",code:"Digit1"},2:{en:"2",enUp:"@",ru:"2",ruUp:'"',code:"Digit2"},3:{en:"3",enUp:"#",ru:"3",ruUp:"№",code:"Digit3"},4:{en:"4",enUp:"$",ru:"4",ruUp:";",code:"Digit4"},5:{en:"5",enUp:"%",ru:"5",ruUp:"%",code:"Digit5"},6:{en:"6",enUp:"^",ru:"6",ruUp:":",code:"Digit6"},7:{en:"7",enUp:"&",ru:"7",ruUp:"?",code:"Digit7"},8:{en:"8",enUp:"*",ru:"8",ruUp:"*",code:"Digit8"},9:{en:"9",enUp:"(",ru:"9",ruUp:"(",code:"Digit9"},0:{en:"0",enUp:")",ru:"0",ruUp:")",code:"Digit0"},"-":{en:"-",enUp:"_",ru:"-",ruUp:"_",code:"Minus"},"+":{en:"=",enUp:"+",ru:"=",ruUp:"+",code:"Equal"},q:{en:"q",enUp:"Q",ru:"й",ruUp:"Й",code:"KeyQ"},w:{en:"w",enUp:"W",ru:"ц",ruUp:"Ц",code:"KeyW"},e:{en:"e",enUp:"E",ru:"у",ruUp:"У",code:"KeyE"},r:{en:"r",enUp:"R",ru:"к",ruUp:"К",code:"KeyR"},t:{en:"t",enUp:"T",ru:"е",ruUp:"Е",code:"KeyT"},y:{en:"y",enUp:"Y",ru:"н",ruUp:"Н",code:"KeyY"},u:{en:"u",enUp:"U",ru:"г",ruUp:"Г",code:"KeyU"},i:{en:"i",enUp:"I",ru:"ш",ruUp:"Ш",code:"KeyI"},o:{en:"o",enUp:"O",ru:"щ",ruUp:"Щ",code:"KeyO"},p:{en:"p",enUp:"P",ru:"з",ruUp:"З",code:"KeyP"},a:{en:"a",enUp:"A",ru:"ф",ruUp:"Ф",code:"KeyA"},s:{en:"s",enUp:"S",ru:"ы",ruUp:"Ы",code:"KeyS"},d:{en:"d",enUp:"D",ru:"в",ruUp:"В",code:"KeyD"},f:{en:"f",enUp:"F",ru:"а",ruUp:"А",code:"KeyF"},g:{en:"g",enUp:"G",ru:"п",ruUp:"П",code:"KeyG"},h:{en:"h",enUp:"H",ru:"р",ruUp:"Р",code:"KeyH"},j:{en:"j",enUp:"J",ru:"о",ruUp:"О",code:"KeyJ"},k:{en:"k",enUp:"K",ru:"л",ruUp:"Л",code:"KeyK"},l:{en:"l",enUp:"L",ru:"д",ruUp:"Д",code:"KeyL"},z:{en:"z",enUp:"Z",ru:"я",ruUp:"Я",code:"KeyZ"},x:{en:"x",enUp:"X",ru:"ч",ruUp:"Ч",code:"KeyX"},c:{en:"c",enUp:"C",ru:"с",ruUp:"С",code:"KeyC"},v:{en:"v",enUp:"V",ru:"м",ruUp:"М",code:"KeyV"},b:{en:"b",enUp:"B",ru:"и",ruUp:"И",code:"KeyB"},n:{en:"n",enUp:"N",ru:"т",ruUp:"Т",code:"KeyN"},m:{en:"m",enUp:"M",ru:"ь",ruUp:"Ь",code:"KeyM"},"[":{en:"[",enUp:"{",ru:"х",ruUp:"Х",code:"BracketLeft"},"]":{en:"]",enUp:"}",ru:"ъ",ruUp:"Ъ",code:"BracketRight"},BackSlash:{en:"\\",enUp:"|",ru:"\\",ruUp:"/",code:"Backslash"},Semicolon:{en:";",enUp:":",ru:"ж",ruUp:"Ж",code:"Semicolon"},Quote:{en:"'",enUp:'"',ru:"э",ruUp:"Э",code:"Quote"},",":{en:",",enUp:"<",ru:"б",ruUp:"Б",code:"Comma"},".":{en:".",enUp:">",ru:"ю",ruUp:"Ю",code:"Period"},"/":{en:"/",enUp:"?",ru:".",ruUp:",",code:"Slash"},Space:{en:" ",enUp:" ",ru:" ",ruUp:" ",code:"Space"},Backspace:{en:"Backspace",code:"Backspace"},Tab:{en:"Tab",code:"Tab"},Del:{en:"Del",code:"Delete"},CapsLock:{en:"CapsLock",code:"CapsLock"},Enter:{en:"Enter",code:"Enter"},Shift:{en:"Shift",code:"ShiftLeft"},ShiftRight:{en:"Shift",code:"ShiftRight"},Ctrl:{en:"Ctrl",code:"ControlLeft"},CtrlRight:{en:"Ctrl",code:"ControlRight"},Win:{en:"Win",code:"MetaLeft"},Alt:{en:"Alt",code:"AltLeft"},AltRight:{en:"Alt",code:"AltRight"},ArrowUp:{en:"↑",enUp:"↑",ru:"↑",ruUp:"↑",code:"ArrowUp"},ArrowLeft:{en:"←",enUp:"←",ru:"←",ruUp:"←",code:"ArrowLeft"},ArrowDown:{en:"↓",enUp:"↓",ru:"↓",ruUp:"↓",code:"ArrowDown"},ArrowRight:{en:"→",enUp:"→",ru:"→",ruUp:"→",code:"ArrowRight"}},s={Space:{style:"keyboard__key--space"},ArrowUp:{style:"keyboard__key--functional"},ArrowLeft:{style:"keyboard__key--functional"},ArrowDown:{style:"keyboard__key--functional"},ArrowRight:{style:"keyboard__key--functional"},Backspace:{type:"Command"},Tab:{type:"Command"},Del:{type:"Command"},Enter:{type:"Command"},CapsLock:{type:"Functional"},Shift:{type:"Functional"},ShiftRight:{type:"Functional"},Ctrl:{type:"Functional"},CtrlRight:{type:"Functional"},Win:{type:"Functional"},Alt:{type:"Functional"},AltRight:{type:"Functional"}};class a extends e{active=!1;led=!1;constructor(e,t,n,o){super(e,t),this.values=n.values,this.type=n.type||"default","default"!==this.type&&this.node.classList.add("keyboard__key--functional"),n.styles&&this.node.classList.add(n.styles),this.value=n.values[o]||n.values.en,this.node.innerHTML=this.value;let s=null,a=null;this.node.onmousedown=()=>{this.active=!0,this.highLight(),n.callback(),"Functional"!==this.type&&(a=setTimeout((()=>{s=setInterval(n.callback,75)}),500))},this.node.onmouseup=()=>{this.active=!1,this.highLight(),clearTimeout(a),clearInterval(s)},this.node.onmouseout=this.node.onmouseup}lightLed(){this.led?this.node.classList.add("keyboard__key--led"):this.node.classList.remove("keyboard__key--led")}highLight(){this.active?this.node.classList.add("keyboard__key--active"):this.node.classList.remove("keyboard__key--active")}keyUp(){this.active=!1,this.highLight()}keyDown(){this.active=!0,this.highLight()}redrawCaption(e,t){if("default"!==this.type)return;const n=`${e}${t.Shift?"Up":""}`;t.CapsLock&&t.Shift?this.value=this.values[n].toLowerCase():t.CapsLock?this.value=this.values[e].toUpperCase():this.value=this.values[n],this.node.innerText=this.value}}class r{buttons={};holded={Shift:!1,CapsLock:!1};holdableKeys=["ShiftLeft","ControlLeft","AltLeft","ShiftRight"];langSwitchKeys=["Control","Alt"];constructor(t,r){this.app=t,this.lang=r;const i=new e(document.querySelector(".wrapper"),{class:"keyboard"});n.forEach((t=>{const n=new e(i.node,{class:"keyboard__row"});t.forEach((e=>{const t={values:o[e],styles:s[e]?s[e].style:null,type:s[e]?s[e].type:null,callback:()=>{this.keyClick(o[e].code)}},i=new a(n.node,{class:"keyboard__key"},t,r),{code:c}=o[e];this.buttons[c]=i}))}))}keyClick(e){const t=this.buttons[e];"Functional"===t.type?this.handleFunctionalKeys(e,"keyClick"):"Command"===t.type?this.app.sendCommand(e):this.app.sendKey(t.value)}keyDown(e){const t=this.buttons[e];t&&(t.keyDown(),"Functional"===t.type?this.handleFunctionalKeys(e,"keyDown"):"Command"===t.type?this.app.sendCommand(e):this.app.sendKey(t.value))}keyUp(e){const t=this.buttons[e];t&&(t.keyUp(),"Functional"===t.type&&this.handleFunctionalKeys(e,"keyUp"))}handleFunctionalKeys(e,t){if("CapsLock"===e&&"keyDown"!==t&&this.handleCapsLock(),this.holdableKeys.includes(e)){const n=e.replace("Left","").replace("Right","");let o;"keyDown"===t&&(o=!0),"keyUp"===t&&(o=!1),"keyClick"===t&&(o=!this.holded[n]),this.handleHoldableKey(e,o)}this.holded[this.langSwitchKeys[0]]&&this.holded[this.langSwitchKeys[1]]&&(this.switchLang(),this.handleHoldableKey(this.langSwitchKeys[0],!1),this.handleHoldableKey(this.langSwitchKeys[1],!1)),"keyUp"===t&&(this.switchLang.alreadySwitched=!1)}handleHoldableKey(e,t){const n=e.replace("Left","").replace("Right","");if(this.holded[n]===t)return;this.holded[n]=t;const o=`${n}Left`;this.buttons[o].led=t,this.buttons[o].lightLed(),"Shift"===n&&this.redrawLayout()}handleCapsLock(){this.holded.CapsLock=!this.holded.CapsLock,this.buttons.CapsLock.led=this.holded.CapsLock,this.buttons.CapsLock.lightLed(),this.redrawLayout()}switchLang(){this.lang="en"===this.lang?"ru":"en",this.redrawLayout(),this.app.switchLang(this.lang)}redrawLayout(){const e={CapsLock:this.holded.CapsLock,Shift:this.holded.Shift};Object.values(this.buttons).forEach((t=>{t.redrawCaption(this.lang,e)}))}}class i{value="";constructor(t){this.app=t;const n=new e(document.querySelector(".wrapper"),{class:"output",tag:"textarea"});this.el=n.node}focus(){this.el.focus()}sendKey(e,t=this.getCaretPos()){let n=this.getValue();const o=t.start<0?0:t.start,s=t.end,a=n.slice(0,o),r=n.slice(s,n.length);n=a+e+r;const i=a.length+e.length;this.outputValue(n,i)}sendCommand(e){this.getValue();const t=this.getCaretPos();"Tab"===e&&this.sendKey("    "),"Enter"===e&&this.sendKey("\r"),"Backspace"===e&&(t.end-t.start>0?this.sendKey(""):this.sendKey("",{start:t.start-1,end:t.end})),"Delete"===e&&(t.end-t.start>0?this.sendKey(""):this.sendKey("",{start:t.start,end:t.end+1}))}getCaretPos(){return{start:this.el.selectionStart,end:this.el.selectionEnd}}setCaretPos(e){this.el.selectionStart=e,this.el.selectionEnd=e}getValue(){return this.el.value}outputValue(e,t){this.el.value=e,this.setCaretPos(t),setTimeout((()=>{this.focus()}),50)}}class c{constructor(t){new e(document.querySelector(".wrapper"),{class:"header-1",tag:"h1"}).node.textContent=t}}class l{constructor(){new e(document.body,{class:"wrapper",tag:"div"})}}class d{constructor(){new l,new c("Virtual keyboard"),this.output=new i;const e=new r(this,localStorage.getItem("lang")||"ru");new t,document.body.addEventListener("keydown",(t=>{t.preventDefault(),e.keyDown(t.code)})),document.body.addEventListener("keyup",(t=>{t.preventDefault(),e.keyUp(t.code)}))}sendKey(e){this.output.sendKey(e)}sendCommand(e){this.output.sendCommand(e)}switchLang(e){localStorage.setItem("lang",e),this.lang=e}}document.addEventListener("DOMContentLoaded",(()=>{new d}))})();